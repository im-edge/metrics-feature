#!/usr/bin/php
<?php

use iPerGraph\Main;
use iPerGraph\RedisPerfDataApi;
use iPerGraph\SelfMonitoring;

require_once dirname(__DIR__) . '/vendor/autoload.php';
$config = include __DIR__ . '/config.inc.php';

$main = new Main();
$redis = new RedisPerfDataApi($main->getLoop(), $main->getLogger(), $config->redis);
$redis->setClientName('iPerGraph::self-monitoring');
$monitor = new SelfMonitoring($main->getLoop(), $redis, $main->getLogger());
$monitor->on('perfData', [$redis, 'shipPerfData']);
$main->startLoop();
